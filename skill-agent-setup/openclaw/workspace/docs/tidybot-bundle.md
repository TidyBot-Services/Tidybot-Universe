# tidybot-bundle

Bundle a TidyBot skill and its dependencies into a single executable Python script.

## Why?

Skills often depend on other skills. For example, `find-and-pick-up` might depend on `center-object` and `pick-up-object`. Running these as separate scripts requires coordination. Bundling inlines everything into one self-contained script that can be executed directly.

## Location

```
~/.openclaw/workspace/skills/tidybot-bundle
```

## Usage

```bash
# Basic usage - output to stdout
tidybot-bundle <skill-name>

# Save to file
tidybot-bundle pick-up-object -o bundled.py

# Custom skills directory
tidybot-bundle my-skill --skills-dir /path/to/skills -o output.py
```

## Options

| Option | Short | Description |
|--------|-------|-------------|
| `--output` | `-o` | Output file (default: stdout) |
| `--skills-dir` | `-d` | Skills directory (default: `~/.openclaw/workspace/skills`) |

## How It Works

### 1. Dependency Resolution

Each skill can have a `deps.txt` file listing its dependencies (one per line):

```
# deps.txt example
center-object
pick-up-object
```

The bundler reads these recursively and builds a dependency graph.

### 2. Topological Sort

Dependencies are sorted so that each skill appears after all its dependencies. This ensures functions are defined before they're called.

```
Example: find-and-pick-up depends on center-object and pick-up-object
         pick-up-object depends on center-object

Order: center-object → pick-up-object → find-and-pick-up
```

### 3. Code Extraction

For each skill in order:
- **Dependencies:** Code is extracted with `if __name__ == "__main__"` blocks removed
- **Main skill:** Full code including the main block

### 4. Output

The bundled script contains:
- Header with metadata (skill name, dependencies, generator)
- Each skill's code with section markers
- Only the main skill's `if __name__ == "__main__"` block

## Example Output

```python
"""
Bundled skill: find-and-pick-up
Dependencies: center-object, pick-up-object
Generated by tidybot-bundle
"""

# ============================================================================
# DEPENDENCY: center-object
# ============================================================================

def center_object(...):
    ...

# ============================================================================
# DEPENDENCY: pick-up-object
# ============================================================================

def pick_up_object(...):
    ...

# ============================================================================
# MAIN: find-and-pick-up
# ============================================================================

def find_and_pick_up(...):
    ...

if __name__ == "__main__":
    # Only the main skill's entry point runs
    ...
```

## Skill Directory Structure

The bundler looks for skills in these locations:
- `<skills-dir>/<skill-name>/main.py`
- `<skills-dir>/<skill-name>-repo/main.py`

A valid skill directory must contain `main.py`.

## Creating a Bundleable Skill

1. Create your skill directory with `main.py`
2. Add `deps.txt` if you depend on other skills
3. Make sure your main functions are importable (not all in `if __name__`)

```
my-skill/
├── main.py      # Your skill code
├── deps.txt     # Optional: one dependency per line
└── README.md    # Optional: documentation
```

## Limitations

- No circular dependency detection (will infinite loop)
- Assumes all skills use compatible imports
- Duplicate imports may appear in bundled output
- No minification or optimization

## Future Improvements

- [ ] Circular dependency detection
- [ ] Import deduplication
- [ ] Verify skill compatibility before bundling
- [ ] Support for non-Python assets
